<ui:composition template="/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<!-- Loads the inbox on every page entry -->
	<f:metadata>
		<f:event type="preRenderView" listener="#{messageBean.loadInbox}" />
	</f:metadata>

	<ui:define name="content">
	
		<h2>×ª×™×‘×ª ×”×“×•××¨ ×”× ×›× ×¡</h2>


		<h:panelGroup rendered="#{not userBean.loggedIn}">
			<h2>×’×™×©×” × ×“×—×ª×” ğŸš«</h2>
			<p>×¢×œ×™×š ×œ×”×ª×—×‘×¨ ×›×“×™ ×œ×”×©×ª××© ×‘×“×£ ×–×”.</p>
			<h:link outcome="login" value="×œ×—×¥ ×›××Ÿ ×›×“×™ ×œ×”×ª×—×‘×¨"
				styleClass="link-button" />
		</h:panelGroup>

		<h:panelGroup rendered="#{userBean.loggedIn}">

			<!-- Navigate to Outbox -->
			<h:button outcome="sent" value="×“×•××¨ ×™×•×¦× ğŸ“¤"
				styleClass="primary-button" />

			<!-- System messages -->
			<h:messages globalOnly="true" />

			<h:panelGroup id="inboxList">
				<!-- No messages -->
				<ui:fragment rendered="#{empty messageBean.inbox}">
					<p>××™×Ÿ ×”×•×“×¢×•×ª ×‘×ª×™×‘×”.</p>
				</ui:fragment>

				<!-- There are messages -->
				<ui:fragment rendered="#{not empty messageBean.inbox}">
					<div class="message-list">
						<ui:repeat value="#{messageBean.inbox}" var="msg">

							<div class="message-card">
								<p>
									<b>×××ª:</b> #{msg.sender.username}
								</p>
								<p>
									<b>× ×•×©×:</b> #{msg.subject}
								</p>
								<p>
									<b>×ª×•×›×Ÿ:</b> #{msg.content}
								</p>
								<p>
									<b>×‘× ×•×’×¢ ×œ×—×™×”:</b> #{empty msg.animal ? 'â€”' : msg.animal.name}
								</p>
								<p>
									<b>× ×©×œ×— ×‘:</b> #{msg.timestampFormatted}
								</p>

								<!-- Answer form -->
								<h:form styleClass="inline-form">
									<h:commandButton value="×”×©×‘ â†©ï¸"
										action="#{messageBean.startReply(msg.id)}"
										styleClass="primary-button">
										<f:ajax execute="@this" render="@form" />
									</h:commandButton>

									<h:panelGroup id="reply" styleClass="reply-box"
										rendered="#{messageBean.replyingToId eq msg.id}">
										<br />
										<h:inputText value="#{messageBean.newMessage.subject}"
											id="replySubject" pt:placeholder="× ×•×©×" />
										<br />
										<br />
										<h:inputTextarea value="#{messageBean.newMessage.content}"
											id="replyContent" rows="4" pt:placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”" />
										<br />
										<br />
										<h:commandButton value="×©×œ×—"
											action="#{messageBean.sendMessage}"
											styleClass="primary-button">
											<!-- ×¨×¢× ×•×Ÿ ×”×ª×©×•×‘×” ×”××§×•××™×ª ×•×”×¨×©×™××” ×”×›×œ×œ×™×ª -->
											<f:ajax execute="@form" render="@form :inboxList @messages" />
										</h:commandButton>
									</h:panelGroup>
								</h:form>

								<!-- Delete -->
								<h:form styleClass="inline-form">
									<h:commandButton value="××—×§ ğŸ—‘ï¸"
										action="#{messageBean.deleteFromInbox(msg.id)}"
										onclick="return confirm('×œ××—×•×§ ××ª ×”×”×•×“×¢×”?');"
										styleClass="primary-button">
										<f:ajax render=":inboxList @messages" />
									</h:commandButton>
								</h:form>

							</div>
						</ui:repeat>
					</div>
				</ui:fragment>
			</h:panelGroup>
		</h:panelGroup>
	</ui:define>
</ui:composition>
